# Репозиторий тестового задания

## Некоторые примечания
Получившийся сценарий создает четыре ноды, так как distributed Minio кластер не может состоять из меньшего их количества, как я понял из документации.

## Описание получившейся системы
Кластер состоит из четырех нод, так как distributed Minio кластер не может состоять из меньшего их количества (как я понял из документации).

Виртуальные машины имеют адреса  
192.168.10.1  
192.168.10.2  
192.168.10.3  
192.168.10.4

Друг друга они видят по этим адресам. Доступ к ним извне (т.е. с локальной машины) осуществляется посредством проброса портов. Веб-сервер доступен по адресу 127.0.0.1 и портам 8001-8004 соответственно. Ноды Minio -- по портам 9001-9004. Для первого хоста также проброшен порт ssh на 22222 для выполнения ad-hoc команд Ansible.

## Развертывение виртуальных хостов
Виртуальные хосты поднимаются командой `vagrant up host1 host2 host3 host4`.

Ansible playbook для их конфигурирования вызывается из Vagrant.

После поднятия хостов имеем работающий кластер Minio и nginx для проксирования и балансировки нагрузки.

## Выполнение действий с использованием ad-hoc команд Ansible
В каталоге /root на серверах находится файл `create-minio-user.sh`, который создает в Minio пользователя `user1` с паролем `testtest` и правами на чтение и запись. Помимо создания пользователя этот скрипт создает bucket с именет test и закачивает туда испорченный джепег с именем testimage.ipg, находящийся в том же каталоге

Запустим этот файл как ad-hoc команду Ansible. Для запуска Ansible будем использовать созданные Vagrant-ом пользователя и приватные ключи. Запустим его на хосте host1. Для этого этот хост внесен в файл inventory, где этот хост в группе test. Там же прописан нестандартный ssh-порт и приватный ключ.

`ansible test -i inventory -u vagrant -b -m raw -a "/root/create-minio-user.sh"`

После выполнения этой команды можно убедиться, что пользователь создан и файл находится в Minio, зайдя через веб-интерфейс на любую ноду.

## Скачивание файла python-скриптом со смещением 1000 байт
Скрипт `get-image.py` скачивает файл testimage.jpg под созданным пользователем `user1`, отрезает от начала 1000 байт и сохраняет его под именем `testimage-fixed.jpg`
